<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>COSMOS core: Agent Server and Client Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo80.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">COSMOS core
   &#160;<span id="projectnumber">1.0.2 (beta)</span>
   </div>
   <div id="projectbrief">Comprehensive Open-architecture Solution for Mission Operations Systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__agentclass.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a>  </div>
  <div class="headertitle">
<div class="title">Agent Server and Client Library<div class="ingroups"><a class="el" href="group__libraries.html">API libraries</a> &raquo; <a class="el" href="group__support.html">Support Libraries</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Agent Server and Client Library:</div>
<div class="dyncontent">
<center><table><tr><td><div class="center"><!-- SVG 0 -->
</div>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__agentclass__functions"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__agentclass__functions.html">Agent Server and Client functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__agentclass__typedefs"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__agentclass__typedefs.html">Agent Server and Client Library typedefs</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Agent Server and Client.</p>
<p>These functions support the transformation of a generic program into a COSMOS aware program. The first level of transformation creates a COSMOS Client that is able to speak the COSMOS language and communicate with any active COSMOS Agents, while the second level of transformation creates a full COSMOS Agent.</p>
<p>Clients are COSMOS aware programs that are made aware of the <a class="el" href="group__jsonlib__namespace.html">JSON Name Space</a>, and are capable of receiving messages broadcast by any Agents on the same <a class="el" href="group__socketlib__constants.html#gac3df430da2e0e847835025092b9dfdcf">NetworkType</a>. These messages, composed of JSON from the <a class="el" href="group__jsonlib__namespace.html">JSON Name Space</a>, contain an initial header containing key information about the sending Agent, plus any additional <a class="el" href="group__jsonlib__namespace.html">JSON Name Space</a> values that the particular Agent cares to make available. This allows the Clients to collect information about the local system, and make requests of Agents. COSMOS Clients are equipped with a background thread that collects COSMOS messages and stores them in a ring. Reading of messages is accomplised through <a class="el" href="group__agentclass__functions.html#ga2bfd2b74883eb369dd1fe7ef1e729362" title="Check Ring for message. ">Cosmos::Agent::readring</a>, which gives you the next message in the ring until you reach the most recent message. Ring size defaults to 100 messages, but can by changed with <a class="el" href="group__agentclass__functions.html#ga4df93666026e9180b6cfe9c03684bf21">Cosmos::Agent::resizering</a>. The ring can be flushed at any time with <a class="el" href="group__agentclass__functions.html#ga0deaf958242b89a436e7cacc338644be">Cosmos::Agent::clearring</a>. Requests to agents are made with <a class="el" href="group__agentclass__functions.html#ga81048eb6c9d2254e64f49a3f1441c747" title="Send a request over AGENT. ">Cosmos::Agent::send_request</a>. As part of its message collection thread, the Client also keeps a list of discovered Agents. This list can be used to provide the Agent information required by <a class="el" href="group__agentclass__functions.html#ga81048eb6c9d2254e64f49a3f1441c747" title="Send a request over AGENT. ">Cosmos::Agent::send_request</a> through use of <a class="el" href="group__agentclass__functions.html#ga2f607e4e5023fcc3ccce30dbb9d8829d" title="Find agent. ">Cosmos::Agent::find_agent</a>. Finally, Clients open a Publication Channel for the sending of messages to other COSMOS aware software. Messages are broadcast, using whatever mechanism is appropriate for the <a class="el" href="group__socketlib__constants.html#gac3df430da2e0e847835025092b9dfdcf">NetworkType</a> chosen, using <a class="el" href="group__agentclass__functions.html#ga1e156ba9e17f232c99927228f658742a" title="Post a Cosmos::Agent::messstruc. ">Cosmos::Agent::post</a>. They can be assigned any of 256 types, following the rules of <a class="el" href="class_cosmos_1_1_agent.html#a59e6f4e4d4501a12b65cb790a93471b3" title="Type of Agent Message. Types &gt; 127 are binary. ">Cosmos::Agent::AgentMessage</a>. The actual content over the network will be a single type byte, a 2 byte unsigned integer in little_endian order containing the length in bytes of the header, a JSON header using values from the <a class="el" href="group__jsonlib__namespace.html">JSON Name Space</a> to represent meta information about the Agent, and optional data, either as bytes (if type &gt; 127), or additional JSON values. The header contains the following fields from the <a class="el" href="structbeatstruc.html">beatstruc</a>, returned from either <a class="el" href="group__agentclass__functions.html#ga2bfd2b74883eb369dd1fe7ef1e729362" title="Check Ring for message. ">Cosmos::Agent::readring</a> or <a class="el" href="group__agentclass__functions.html#ga2f607e4e5023fcc3ccce30dbb9d8829d" title="Find agent. ">Cosmos::Agent::find_agent</a>:</p><ul>
<li><a class="el" href="structbeatstruc.html#a51a89eca3d0158e98163af55beecbff1">beatstruc::utc</a>: The time of posting, expressed in Modified Julian Day.</li>
<li><a class="el" href="structbeatstruc.html#aed6bbaeb77bcc53c7a3a8643a93ca4b4">beatstruc::node</a>: The name of the associated Node.</li>
<li><a class="el" href="structbeatstruc.html#a1da2e5c0ceeb8b82289884823b8ff717" title="Heartbeat Agent Name. ">beatstruc::proc</a>: The name of the associated Agent.</li>
<li><a class="el" href="structbeatstruc.html#a31b815739026846b72a9a9989fbfee31" title="Protocol Address. ">beatstruc::addr</a>: The appropriate address for the <a class="el" href="group__socketlib__constants.html#gac3df430da2e0e847835025092b9dfdcf">NetworkType</a> of the sending machine.</li>
<li><a class="el" href="structbeatstruc.html#a5c877ce2b7cf09465e23b97482ad9843" title="AGENT port. ">beatstruc::port</a>: The network port the Agent is listening on.</li>
<li><a class="el" href="structbeatstruc.html#ab1a132a5634f62581e3dd81bab17d129" title="Transfer buffer size. ">beatstruc::bsz</a>: The size, in bytes, of the Agents request buffer.</li>
<li><a class="el" href="structbeatstruc.html#a5653d9b945f27a9acf0c4672244c6788" title="Agent % CPU. ">beatstruc::cpu</a>: The CPU load of the machine the Agent is running on.</li>
<li><a class="el" href="structbeatstruc.html#a1bb3da827f3f54abc0e6a2e7e9aeae90" title="Agent % memory. ">beatstruc::memory</a>: The memory usage of the machine the Agent is running on.</li>
<li><a class="el" href="structbeatstruc.html#abd8fae4273cad137c6af8b04636a7736" title="Agent heartbeat jitter [sec]. ">beatstruc::jitter</a>: The residual jitter, in seconds, of the Agents heartbeat loop.</li>
<li><a class="el" href="structnodestruc.html#a1ed0eb848bb5534b7844c13a2727b11e" title="MJD Offset between system UT and simulated UT. ">nodestruc::utcoffset</a>: The offset, in Days, being applied to this times to time shift it.</li>
</ul>
<p>Agents are persistent COSMOS aware programs that provide the system framework for any COSMOS implementation. They are similar to UNIX Daemons or Windows Services in that they run continuously until commanded to stop, and serve a constant function, either automatically or on demand. In addition to the features listed for Clients, Agents are provided with two additional features, implemented as two additional threads of execution.</p>
<ul>
<li>"Heartbeat": This is a Message, as described above, sent at regular intervals, with type Agent::AgentMessage::BEAT. The optional data can be filled with State of Health information, established through <a class="el" href="group__agentclass__functions.html#ga5c498fd14ffe4aa64c37375776da4743" title="Set SOH string. ">Cosmos::Agent::set_sohstring</a>.</li>
<li>"Requests": Requests are received as plain text commands and arguments, at the IP Port reported in the Heartbeat. They are processed and any response is sent back. The response, even if empty, always ends with [OK], if understood, or [NOK] if not. Requests and their responses must be less than the size of the communications buffer. There are a number of requests already built in to the Agent. Additional requests can be added using <a class="el" href="group__agentclass__functions.html#ga3554b695e778e2c8c88529b550183553" title="Add external request to Agent request list with description and synopsis. ">Cosmos::Agent::add_request</a>, by tieing together user defined functions with user defined ASCII strings. Built in requests include:<ul>
<li>"help" - list available requests for this Agent.</li>
<li>"shutdown" - causes the Agent to stop what it is doing and exit.</li>
<li>"idle" - causes the Agent to transition to <a class="el" href="class_cosmos_1_1_agent.html#a0423e290995b3df322bd894a2b9701f4aa5daf7f2ebbba4975d61dab1c40188c7" title="Do minimal necessary to run. ">Cosmos::Agent::State::IDLE</a>.</li>
<li>"monitor" - causes the Agent to transition to <a class="el" href="class_cosmos_1_1_agent.html#a0423e290995b3df322bd894a2b9701f4aff3e179b3cc64393841107ccba0d6e48" title="Run with monitoring. ">Cosmos::Agent::State::MONITOR</a>.</li>
<li>"run" - causes the Agent to transition to <a class="el" href="class_cosmos_1_1_agent.html#a0423e290995b3df322bd894a2b9701f4a855520d2a5b0b1a64b939e7e30889e2a" title="Run without monitoring. ">Cosmos::Agent::State::RUN</a>.</li>
<li>"status" - causes the agent to dump any <a class="el" href="group__jsonlib.html">JSON Library</a> variables it is monitoring.</li>
<li>"getvalue {\"json_name_000"[,"json_name_001"]}" - requests the Agent to return the values of the indicated JSON names.</li>
<li>"setvalue {\"json_name_000":value0[,"json_name_001":value1]}" - requests the Agent to set the values of the indicated JSON names.</li>
<li>"echo utc crc nbytes bytes" - requests the Agent to echo the local time the request was received, the CRC calculated for the bytes, and the bytes themselves.</li>
<li>"nodejson" - return the JSON representing the contents of node.ini.</li>
<li>"statejson" - return the JSON representing the contents of state.ini.</li>
<li>"utcstartjson" - return the JSON representing the contents of utcstart.ini.</li>
<li>"piecesjson" - return the JSON representing the contents of pieces.ini.</li>
<li>"facesjson" - return the JSON representing the contents of faces.ini.</li>
<li>"vertexsjson" - return the JSON representing the contents of vertexs.ini.</li>
<li>"devgenjson" - return the JSON representing the contents of devgen.ini.</li>
<li>"devspecjson" - return the JSON representing the contents of devspec.ini.</li>
<li>"portsjson" - return the JSON representing the contents of ports.ini.</li>
<li>"aliasesjson" - return the JSON representing the contents of aliases.ini.</li>
<li>"targetsjson" - return the JSON representing the contents of targets.ini.</li>
</ul>
</li>
</ul>
<p>Both Clients and Agents are formed using <a class="el" href="class_cosmos_1_1_agent.html">Cosmos::Agent</a>. Once you have performed any initializations necessary, you should enter a continuous loop, protected by <a class="el" href="group__agentclass__functions.html#ga59c00820cf975e432ee3edd54198b5ae" title="Check if we&#39;re supposed to be running. ">Cosmos::Agent::running</a>, and preferably surrendering control periodically with Cosmos::COSMOS_SLEEP. Upon exiting from this loop, you should call <a class="el" href="group__agentclass__functions.html#ga169e2d7af28306cc51118ea903b405a1" title="Shutdown agent gracefully. ">Cosmos::Agent::shutdown</a>. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Mar 11 2019 15:06:00 for COSMOS core by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
