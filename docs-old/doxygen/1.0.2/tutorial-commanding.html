<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>COSMOS core: COSMOS Commands</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo80.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">COSMOS core
   &#160;<span id="projectnumber">1.0.2 (beta)</span>
   </div>
   <div id="projectbrief">Comprehensive Open-architecture Solution for Mission Operations Systems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorial-commanding.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">COSMOS Commands </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are two mechanisms for commanding actions in COSMOS. The first involves direct commanding of Agents via their network request port. The second involves the placement of commands in the Executive Command Queue, to be run either immediately, or at some later time.</p>
<h1>1. Direct Commanding</h1>
<p>Each Agent listens for requests over a network port determined at random when it launches. This port can be discovered by listening to the heartbeats delivered by Agents at regular intervals. To access this process from the command line, make use of the "agent" command. To get a list of available Agents, use "agent list". This will display a variety of parameters about each Agent, the most important of which are their NodeName and AgentName. Each Agent running will have a unique combination of NodeName and AgentName. These can then be used to make requests of the Agent with "agent NodeName AgentName". Given in this way, with no additional arguments, it will list all available requests that can be made to the Agent. There are a certain set of requests that all Agents will respond to. Additionally, each Agent can be programmed to respond to a variety of additional requests. The function and calling format of all of these requests are available through "agent NodeName AgentName".</p>
<p>Example. Let's play a bit with the antenna commands. First check the antena status:</p>
<div class="fragment"><div class="line">$ agent_client kauaicc_sim yagi get_state</div><div class="line">[57654.363982] Cx: 1 En: 0 Target:    0.0    0.0 (   0.0    0.0) Actual: 0.0    0.0 Offset:    0.0    0.0[OK] [112]</div></div><!-- fragment --><p>Let's enable the yagi antenna rotor</p>
<div class="fragment"><div class="line">$ agent kauaicc_sim yagi enable</div></div><!-- fragment --><p>now let's set the azimuth and elevation </p><div class="fragment"><div class="line">$ agent_client kauaicc_sim yagi set_azel 1.2 3.4</div></div><!-- fragment --><p>check if it was enabled and what's the target azimuth and elevation </p><div class="fragment"><div class="line">$ agent_client kauaicc_sim yagi get_state</div><div class="line">[57654.363982] Cx: 1 En: 1 Target:    1.2    2.2 (   0.0    0.0) Actual: 1.2    2.2 Offset:    0.0    0.0[OK] [112]</div></div><!-- fragment --><p> 'En: 1' means it was enabled</p>
<h1>2. Executive Command Queue</h1>
<p>The process agent_execsoh maintains a queue of commands. At a rate set by the Agent Period, this queue is searched for any commands whose execute UTC has been exceeded. Commands on the command queue are typically exectuted with 100 ms granularity. If any command in this short list has an optional condition, it is checked as well, and if zero, ignored. Finally, any commands that have already been run are ignored. Any commands left are executed, and then removed if not marked as repeating. Commands are entered into the queue as a Command Event in one of two ways:</p>
<ul>
<li>First they can be sent as a request via direct commanding to agent_execsoh using "agent NodeName execsoh add_queue ...".</li>
<li>Second, they can be stored in a file with a .command extension and placed in the "incoming/exec" subfolder of the nodes folder. They will then be loaded into the command queue within the next Agent Period.</li>
</ul>
<p>Commands can be removed by first listing with "agent NodeName get_queue", and then removing with "agent NodeName del_queue #". Any command that is run will be logged in two separate locations. A command event record will be added to a command event file. The actual output of the command will be added to a command output file. Both files will be placed in the temp/exec subfolder of the node folder, and then periodically moved to the "outgoing/exec"subfolder.</p>
<p>To create commands run in bin folder </p><div class="fragment"><div class="line">$ command_generator</div></div><!-- fragment --><p>Example. Let's create a command using the 'command_generator' to enable the yagi antenna, with the name 'turn_on_yagi' and command 'enable' on the mjd time '57654.3822993104':</p>
<div class="fragment"><div class="line">$ command_generator turn_on_yagi enable 57654.3822993104</div></div><!-- fragment --><p>the result is the json formated command string that can be copied to a command file (ex: turn_on_yagi.command) and put on the incoming/exec folder (in this case it's the cosmos/nodes/kauaicc_sim/incoming/exec)</p>
<div class="fragment"><div class="line">{&quot;event_utc&quot;:57654.382299310397}{&quot;event_name&quot;:&quot;turn_on_yagi&quot;}{&quot;event_type&quot;:8192}{&quot;event_flag&quot;:0}{&quot;event_data&quot;:&quot;agent kauaicc_sim yagi enable&quot;}</div></div><!-- fragment --><p>note that event type 8192 represents a command event</p>
<p>if you have a terminal window open with the agent_soh_exec you will see that as soon as the command file is put into the incoming/exec folder the command is loaded into the queue and is displayed in the terminal window:</p>
<div class="fragment"><div class="line">$ agent_exec_soh kauaicc_sim</div><div class="line">Starting the executive/soh agent-&gt;..  started.</div><div class="line">{&quot;event_utc&quot;:57655.3822993104}{&quot;event_utcexec&quot;:0}{&quot;event_name&quot;:&quot;turn_on_yagi&quot;}{&quot;event_type&quot;:8192}{&quot;event_flag&quot;:0}{&quot;event_data&quot;:&quot;enable&quot;}{&quot;event_condition&quot;:&quot;agent kauaicc_sim yagi enable&quot;}The size of the command queue is: 1</div></div><!-- fragment --><p>if the command is waiting to be executed (is in the queue) then you can ask to see the list of commands in the queue</p>
<div class="fragment"><div class="line">$ gent kauaicc_sim execsoh get_queue_entry</div><div class="line">{&quot;event_utc&quot;:57655.3822993104}{&quot;event_utcexec&quot;:0}{&quot;event_name&quot;:&quot;turn_on_yagi&quot;}{&quot;event_type&quot;:8192}{&quot;event_flag&quot;:0}{&quot;event_data&quot;:&quot;enable&quot;}{&quot;event_condition&quot;:&quot;agent kauaicc_sim yagi enable&quot;}</div><div class="line">[OK] [163]</div></div><!-- fragment --><p>to execute the command immediatelly we just have to change the 'event_utc' time in the command file to 0</p>
<div class="fragment"><div class="line">{&quot;event_utc&quot;:0}{&quot;event_name&quot;:&quot;turn_on_yagi&quot;}{&quot;event_type&quot;:8192}{&quot;event_flag&quot;:0}{&quot;event_data&quot;:&quot;agent kauaicc_sim yagi enable&quot;}</div></div><!-- fragment --><p>one other alternative to generate commands is to use the 'command_generator.sh' script in the cosmos-source/core/scripts/ folder</p>
<div class="fragment"><div class="line">./command_generator.sh </div><div class="line"></div><div class="line">Please enter an event name:     test</div><div class="line">Please enter a UTC time:        0</div><div class="line">What is the event command?      agent</div><div class="line">Is your event repeatable? (y/n):    y</div><div class="line">Is your event conditional? (y/n):   n</div></div><!-- fragment --><p>this will generate a 'autogen.command' file in the same folder.</p>
<p>one other alternative is to use the python script 'command_generator.py'</p>
<div class="fragment"><div class="line">$ python command_generator.py</div><div class="line">┌──────────────────────────────────────────────────────────────────────────────┐</div><div class="line">│ ┌──────────────────────────────────────────────────────────────────────────┐ │</div><div class="line">│ │  Super Pretty Awesome Command Event File Generator Thingy --- SPACEFGT   │ │</div><div class="line">│ └──────────────────────────────────────────────────────────────────────────┘ │</div><div class="line">│                    ┌─────────────────────────────────────────┐               │</div><div class="line">│       Event Name:  │                                         │               │</div><div class="line">│                    └─────────────────────────────────────────┘               │</div><div class="line">│                    ┌─────────────────────┐                       ┌──┐        │</div><div class="line">│   Event UTC Time:  │                     │        Repeatable? :  │  │        │</div><div class="line">│                    └─────────────────────┘                       └──┘        │</div><div class="line">│                    ┌─────────────────────────────────────────┐               │</div><div class="line">│    Event Command:  │                                         │               │</div><div class="line">│                    │                                         │               │</div><div class="line">│                    │                                         │               │</div><div class="line">│                    └─────────────────────────────────────────┘   ┌──┐        │</div><div class="line">│                                                  Conditional? :  │  │        │</div><div class="line">│                    ┌─────────────────────────────────────────┐   └──┘        │</div><div class="line">│  Event Condition:  │                                         │               │</div><div class="line">│                    └─────────────────────────────────────────┘               │</div><div class="line">│                    ┌─────────────────────────────────────────┐               │</div><div class="line">│  Event File Name:  │                                         │               │</div><div class="line">│                    └─────────────────────────────────────────┘               │</div><div class="line">│                                                                              │</div><div class="line">└──────────────────────────────────────────────────────────────────────────────┘</div></div><!-- fragment --><p>this will also generate a command on the same folder </p><hr/>
<p> These are just notes for follow up documentation, please ignore.</p>
<p>pending notes</p><ul>
<li>request script to send all the arguments</li>
<li>conditions</li>
</ul>
<p>future developments</p><ul>
<li>paralel commanding</li>
<li>command grouping </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="tutorials-examples.html">Tutorials and Examples</a></li>
    <li class="footer">Generated on Mon Mar 11 2019 15:05:50 for COSMOS core by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
